{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/ilcorsaronero-api-node-js-module-to-get-italian-torrents","webpackCompilationHash":"9b2db3de2568cbac6311","result":{"data":{"site":{"siteMetadata":{"repoUrl":"https://github.com/giacomocerquone/giacomocerquone.com/tree/master/content/blog","siteUrl":"https://giacomocerquone.com"}},"markdownRemark":{"id":"bed768a6-3155-59c2-bdcd-8ea7e2151718","fields":{"readingTime":{"text":"3 min read"}},"excerpt":"Hello guys, today we’re going to talk of another minor minor (minor) project that is coming to life thanks to another big project of mine that I should have…","html":"<p>Hello guys, today we’re going to talk of another minor minor (minor) project that is coming to life thanks to another big project of mine that I should have already released but due to my slowness I’m still not ready to show it (yes, I’m talking of the same project I was talking in this <a href=\"http://blog.giacomocerquone.com/loading-animation-with-pure-css/\">other post</a>). Anyway let’s talk about what this module I developed does and how.</p>\n<h2>What was I trying to accomplish?</h2>\n<p>So my goal was to search in node for italian torrents and the only good italian torrent search engine that I know is ilcorsaronero.info, it’s not so much different than KickAss, The Pirate Bay etc.\nSince they doesn’t have any kind of API, I needed to scrape these information (<a href=\"https://en.wikipedia.org/wiki/Web_scraping\">here</a> if you don’t know what’s this technique) and when we talk about “scraping” only two libraries come to the mind of a node developer: cheeriojs and request. The first one is, in two words, a server side jquery implementation and second is used to make requests and get the html of a webpage… they make the art of web scraping a child’s play.</p>\n<p>Before we look at the code, <a href=\"https://github.com/giacomocerquone/ilcorsaronero-api\">here the github page</a> and <a href=\"https://www.npmjs.com/package/ilcorsaronero-api\">here the npm page</a></p>\n<h2>Talking is for pussies, coding is for real men</h2>\n<p>So let’s see the most important piece of code of this library just to show what I did technically (a lot of lines has been deleted down here) :</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">scrape</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">url<span class=\"token punctuation\">,</span> cat<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token function\">request</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> body</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>error <span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span> response<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">var</span> $ <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      <span class=\"token comment\">// We'll store retrieved data here</span>\n      <span class=\"token keyword\">var</span> result <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          counter <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span>\n          items <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.odd, .odd2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n      items<span class=\"token punctuation\">.</span><span class=\"token function\">each</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">i<span class=\"token punctuation\">,</span> row</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Unluckily the magnets are not accessible from the search page. We must access the torrent page and get the magnet</span>\n        <span class=\"token function\">request</span><span class=\"token punctuation\">(</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'td'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"href\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">error<span class=\"token punctuation\">,</span> response<span class=\"token punctuation\">,</span> body</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>error <span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span><span class=\"token operator\">&amp;</span>amp<span class=\"token punctuation\">;</span> response<span class=\"token punctuation\">.</span>statusCode <span class=\"token operator\">==</span> <span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">var</span> $<span class=\"token number\">2</span> <span class=\"token operator\">=</span> cheerio<span class=\"token punctuation\">.</span><span class=\"token function\">load</span><span class=\"token punctuation\">(</span>body<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                catScraped <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'td'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                name <span class=\"token operator\">=</span> <span class=\"token function\">$2</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#content &amp;gt; #body &amp;gt; center'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                link <span class=\"token operator\">=</span> <span class=\"token function\">$2</span><span class=\"token punctuation\">(</span><span class=\"token string\">'.magnet'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">attr</span><span class=\"token punctuation\">(</span><span class=\"token string\">'href'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                size <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'td'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                date <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'td'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                seeds <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'td'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n                peers <span class=\"token operator\">=</span> <span class=\"token function\">$</span><span class=\"token punctuation\">(</span>row<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">children</span><span class=\"token punctuation\">(</span><span class=\"token string\">'td'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">eq</span><span class=\"token punctuation\">(</span><span class=\"token number\">6</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">text</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n              result<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">{</span> <span class=\"token string\">\"cat\"</span><span class=\"token punctuation\">:</span> catScraped<span class=\"token punctuation\">,</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">:</span> name<span class=\"token punctuation\">,</span> <span class=\"token string\">\"link\"</span><span class=\"token punctuation\">:</span> link<span class=\"token punctuation\">,</span> <span class=\"token string\">\"size\"</span><span class=\"token punctuation\">:</span> size<span class=\"token punctuation\">,</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">:</span> date<span class=\"token punctuation\">,</span> <span class=\"token string\">\"seeds\"</span><span class=\"token punctuation\">:</span> seeds<span class=\"token punctuation\">,</span> <span class=\"token string\">\"peers\"</span><span class=\"token punctuation\">:</span> peers <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            counter<span class=\"token operator\">++</span><span class=\"token punctuation\">;</span>\n            <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>counter <span class=\"token operator\">==</span> items<span class=\"token punctuation\">.</span>length<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>I defined a “scrape” function within, with request, I requested the “html” of a webpage passed through parameter. After I passed as parameter to cheerio the webpage in order to use the classical jquery selector to get attributes, texts and everything else we need. You see two requests in the code: the first is the search page, and for every item resulted from the search it will request for another link (due to the structure of ilcorsaronero that doesn’t expose the magnet links in the search page). And at the end there is a callback call (of course the code is async and a callback is required to get the scraped results).</p>\n<h2>Final Notes</h2>\n<p>I hope someone will appreciate this and if you do something great with this library make me know about it through comments or privately on social network!\nStay awesome guys :D</p>","frontmatter":{"imgAuthor":"me","imageAlt":"panda with laptop","image":{"childImageSharp":{"fluid":{"tracedSVG":"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='400'%20height='267'%3e%3cpath%20d='M158%2036l-6%2014-6%2010c-11%2014-17%2029-21%2054-2%2014-2%2019%202%2023%203%204%203%204%202%206-5%206-6%2012-2%2019%203%206%202%2011-3%2016l-5%208-3%203%201-4c2-4-2-7-8-7-5%200-5%200-5-2%200-3%200-3-4-3-3%201-4%200-5-1-2-2-2-2-3-1%200%202-4%201-4-1l-2-2-2%201-2%201-2-1%202-1%202-1-10-2h-2c0-2-1-2-4-2l-4-1c0-2-1-2-3-2-3%200-5-1-8-4-4-4-5-4-5-2-1%203-3%203-6%200-1-2-1-2%201-2s2-1%202-4c0-4%200-4-2-4s-3%201-3%202l-1%202-2-13c0-12-1-15-4-15l-1%204c0%205-2%205-2%201v-5l-1-9c0-5%200-7-1-6h-1l-2-1c-3%200-5-3-4-6%201-1%200-3-2-4l-3-5c0-2-1-4-4-6l-4-2c0%203-3%203-4%201v-2c3%200%201-3-3-5-1-1-1%2018-1%2095v97h258v-3c0-2-1-3-2-3l-4-3-3-2c-2%200-3-1-3-2l-4-3-4-4c0-2-5-5-10-5l-4-1%202-1c2%200%201-2-2-4-7-2-6-4%202-4%204%200%202-1-6-1l-12-1h17l17-1v-39l-3-1c-4%200-4%200-5-3%200-5%201-6%2016-5%2015%200%2017-1%2013-4s-5-9-3-13c5-6%205-15%200-20-3-3-3-4%201-7%203-2%203-3%203-10%200-16-5-37-12-51-4-8-11-19-13-20l-4-9c-5-13-6-13-11-9l-4%203-7-3c-11-4-29-4-40%201-5%202-4%202-11-3h-4m-4%2088h-18l1%204a2459%202459%200%20016%2043c3%201%2015-1%2020-3a140%20140%200%200168%202c12%202%2015%202%2016-1a1889%201889%200%20005-42v-3h-13a6153%206153%200%2001-85%200'%20fill='%23d3d3d3'%20fill-rule='evenodd'/%3e%3c/svg%3e","aspectRatio":1.5,"src":"/static/f441ca699ebcc5b64e67312ae72b8939/f709c/ilcorsaronero-api.jpg","srcSet":"/static/f441ca699ebcc5b64e67312ae72b8939/d278e/ilcorsaronero-api.jpg 200w,\n/static/f441ca699ebcc5b64e67312ae72b8939/8539d/ilcorsaronero-api.jpg 400w,\n/static/f441ca699ebcc5b64e67312ae72b8939/f709c/ilcorsaronero-api.jpg 450w","sizes":"(max-width: 450px) 100vw, 450px"},"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAABAv/EABUBAQEAAAAAAAAAAAAAAAAAAAMC/9oADAMBAAIQAxAAAAFWkQSsuYL/AP/EABoQAAICAwAAAAAAAAAAAAAAAAARAQIDITH/2gAIAQEAAQUCeqTZjMfT/8QAGBEAAgMAAAAAAAAAAAAAAAAAAQIDEBL/2gAIAQMBAT8BSPIr/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAIR/9oACAECAQE/Aba//8QAFhAAAwAAAAAAAAAAAAAAAAAAACAi/9oACAEBAAY/Ail//8QAGhAAAwADAQAAAAAAAAAAAAAAAAERECExof/aAAgBAQABPyFPbXTV8vFyGjO2+FP/2gAMAwEAAgADAAAAEDsP/8QAFhEBAQEAAAAAAAAAAAAAAAAAAAER/9oACAEDAQE/EKwY/8QAFhEBAQEAAAAAAAAAAAAAAAAAEQEQ/9oACAECAQE/EIFz/8QAGxABAQEAAgMAAAAAAAAAAAAAAREAIVEQcbH/2gAIAQEAAT8QMRQcHbjzKFGHCeBGrHp1IqAA/HvCm//Z","width":450,"height":300,"src":"/static/f441ca699ebcc5b64e67312ae72b8939/f709c/ilcorsaronero-api.jpg","srcSet":"/static/f441ca699ebcc5b64e67312ae72b8939/f709c/ilcorsaronero-api.jpg 1x"}}},"slug":"blog/ilcorsaronero-api-node-js-module-to-get-italian-torrents","title":"ilcorsaronero-api: get italian torrents","date":"December 20, 2015","description":"Node.js module to search and get italian torrents on ilcorsaronero.info"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"dir":"/ilcorsaronero-api-node-js-module-to-get-italian-torrents/ilcorsaronero-api-node-js-module-to-get-italian-torrents/","slug":"/blog/ilcorsaronero-api-node-js-module-to-get-italian-torrents","previous":{"fields":{"slug":"/blog/jingle-bell-with-an-arduino-and-a-buzzer","dir":"/jingle-bell-with-an-arduino-and-a-buzzer/jingle-bell-with-an-arduino-and-a-buzzer/"},"frontmatter":{"title":"Jingle Bells with a Buzzer and Arduino","draft":null}},"next":{"fields":{"slug":"/blog/jekyll-vs-hexo","dir":"/jekyll-vs-hexo/jekyll-vs-hexo/"},"frontmatter":{"title":"jekyll (ruby) vs hexo (node)","draft":null}}}}}