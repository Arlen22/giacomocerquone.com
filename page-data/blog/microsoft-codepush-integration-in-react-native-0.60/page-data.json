{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/microsoft-codepush-integration-in-react-native-0.60","webpackCompilationHash":"88bc18c3684f0a88e1b7","result":{"data":{"site":{"siteMetadata":{"repoUrl":"https://github.com/giacomocerquone/giacomocerquone.com/tree/master/content/blog","siteUrl":"https://giacomocerquone.com"}},"markdownRemark":{"id":"9a49422e-e72b-542b-8385-e645652d17be","excerpt":"The world has been spinning pretty fast lately, hasn’t it?\nIn the development process what we’re used to call ”continuous delivery” is what allowed us, as end…","html":"<p>The world has been spinning pretty fast lately, hasn’t it?\nIn the development process what we’re used to call ”<strong>continuous delivery</strong>” is what allowed us, as end users, to perceive changes in a blazingly fast way and it’s what allows us, as developers, to <strong>push fixes</strong> and new features faster to the end user.\nYou’ll find so many articles about it and maybe you still are figuring out what it really is but remember, these apparently abstract and hard to follow concepts that pops up here and there nowadays always boil down somehow to something practical: a tool, a service or an architecture that let you do something.</p>\n<p>But how can we effectively do this in the world of mobile development? Through <strong>over-the-air</strong> udpates.\nIt’s the ability of an app to receive bugfixes and features that can be <strong>applied at runtime</strong> and refresh the user experience. This means no store approval, no build time and lots of other simplifications.</p>\n<h2>General inner working</h2>\n<p>Clearly I won’t talk about other platforms, but OTA updates aren’t possible on every framework due to their different inner workings.\nIn React Native we are “required” to build a <strong>JavaScript bundle</strong> in order to produce a production app. That js bundle, called index.android.bundle in Android and main.jsbundle in iOS, is bundled within the aab/apk/ipa and then the Java/Obj-C code of our React Native app will use it.\nSo how are OTA delivered? Simple, replacing that bundle, when certain conditions are met, through a native linked library that restarts the execution of that bundle at runtime.</p>\n<p>Now <strong>understanding how something works</strong> is the only way you can <strong>improve yourself</strong> and become as independent as possible. I might also have tempted a personal implementation of this mechanism, but it’d be silly since we have <strong>Microsoft CodePush</strong>: a tool, inside the app center, made exactly to deliver OTA updates.</p>\n<h2>Configuration</h2>\n<p>Online resources are a bit scarse on how to:</p>\n<ul>\n<li>Use the <a href=\"http://appcenter.ms/apps\">appcenter.ms</a> website dashboard</li>\n<li>Properly configure this library</li>\n<li>Use the appcenter cli</li>\n</ul>\n<p>There is a <a href=\"https://docs.microsoft.com/en-us/appcenter/\">huge unhandy microsoft documentation</a> about it, but at the same time it’s possible to find many commands out in the wild of the old version of the cli that don’t works anymore.</p>\n<h2>Configure the app in the App Center dashboard</h2>\n<p>There shouldn’t be the need of explaining how the app should be set up on the App Center dashboard but, turns out, there is a very peculiar thing I discovered and so I decided to walk you step by step in this.</p>\n<p>Basically you can’t configure a single app (and therefore use a single key) to release updates to both your Android and iOS apps. <strong>You must configure two apps targeting two different OS</strong>. This is confusing also because an old version of the cli allowed to specify multiple OS of a single app when releasing the updates.</p>\n<p><em>NOTE: in the docs this is taken for granted and nowhere seems to be mentioned, the only warning you can find is this and it doesn’t tell us much</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e77f59b19b553cebee89590b24fe158/8b843/appcenter-warning.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.22347066167291%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB2INLBH//xAAWEAEBAQAAAAAAAAAAAAAAAAAAAUH/2gAIAQEAAQUC1H//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhMVH/2gAIAQEAAT8hcyt6X1mT/9oADAMBAAIAAwAAABAEH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAAB/9oACAECAQE/EFf/xAAaEAACAwEBAAAAAAAAAAAAAAAAASExQRHh/9oACAEBAAE/EHp0tO+od3bc6f/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"App Center Warning\"\n        title=\"App Center Warning\"\n        src=\"/static/1e77f59b19b553cebee89590b24fe158/c739e/appcenter-warning.jpg\"\n        srcset=\"/static/1e77f59b19b553cebee89590b24fe158/8ee9c/appcenter-warning.jpg 148w,\n/static/1e77f59b19b553cebee89590b24fe158/ebbe7/appcenter-warning.jpg 295w,\n/static/1e77f59b19b553cebee89590b24fe158/c739e/appcenter-warning.jpg 590w,\n/static/1e77f59b19b553cebee89590b24fe158/8b843/appcenter-warning.jpg 801w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Linking and JS implementation</h2>\n<p>The entire library is going under heavy maintenance and for this reason something may be a bit outdated and something else might be missing: <strong>no hooks support</strong>, <strong>no autolinking support</strong>.</p>\n<p>Since this library doesn’t support autolinking, when installed you must launch <strong>react-native link react-native-code-push</strong> and it will ask you for one of the key retrieved at the previous step.\nMy advice here is:</p>\n<ul>\n<li>Write it in the terminal while linking if you know you’ll just use one deployment key for your app (the key relative to the <em>Production</em> deployment name for example).</li>\n<li>Leave it empty if you plan to use various deployments (<em>Production</em>, <em>Staging</em> ecc.) in order to effectively handle the keys from the js side.</li>\n</ul>\n<h2>Important CLI commands</h2>\n<p>Let’s see an handy collection of the main useful commands you can refer to <br/></p>\n<p><em>NOTE: Microsoft calls it deployment name (or simply deployment), it is also often referred to as lanes, product flavors, build schemes or also specific deploy and they indicate some sort of specific configuration of your app: stage, dev, production, production-IT ecc.</em></p>\n<h4>DEPLOY (to a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush release-react -a &lt;owner&gt;/&lt;appName&gt; -d &lt;deploymentName&gt; -t &lt;version&gt;</code></pre></div>\n<h4>LIST APPS FOR CURRENT USER</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter apps list</code></pre></div>\n<h4>ADD A DEPLOYMENT NAME (to an app)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush deployment add -a {owner}/{appName} &lt;deploymentName&gt;</code></pre></div>\n<h4>LIST DEPLOYMENT NAMES AND KEYS (of an app)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush deployment list -a {owner}/{appName} --displayKeys</code></pre></div>\n<h4>DELETE ALL EXISTING RELEASES (of a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush deployment clear -a &lt;ownerName&gt;/&lt;appName&gt; &lt;deploymentName&gt;</code></pre></div>\n<h4>UNDO LAST RELEASE (of a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush rollback -a &lt;owner-name&gt;/&lt;app-name&gt; &lt;deploymentName&gt;</code></pre></div>\n<h4>DISABLE SPECIFIC RELEASE (of a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush patch -a &lt;owner-name&gt;/&lt;app-name&gt; &lt;deploymentName&gt; &lt;existingReleaseLabel&gt; --disabled</code></pre></div>\n<p><code class=\"language-text\">patch</code> is actually a very powerful utility that let you modify a release. <a href=\"https://docs.microsoft.com/en-us/appcenter/distribution/codepush/cli#patching-update-metadata\">Make sure to checkout the docs</a> to discover what you can do with it!</p>\n<p><em>NOTE: the difference between disabling and rolling back is that the first one just disable a release so the app will get the previous one while the rollback create a new release equal to the second-last release in order to nullify the latest</em></p>\n<p>If you need any kind of support, reach out to me on twitter, I’d be glad to help.</p>","frontmatter":{"slug":"blog/microsoft-codepush-integration-in-react-native-0.60","title":"Microsoft CodePush Integration in React Native 0.60+","date":"November 25, 2019","description":"Microsoft CodePush is a powerful tool but can be very exhausting to configure. Let's cycle over the necessary details","image":{"childImageSharp":{"fixed":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHKtUgWBcT/xAAYEAEBAQEBAAAAAAAAAAAAAAABABESE//aAAgBAQABBQIxvMZ4hbWb/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEgMf/aAAgBAQAGPwI1T//EABoQAQACAwEAAAAAAAAAAAAAAAEAETFBcZH/2gAIAQEAAT8hZU0vJoekAUW+QG2LZZlP/9oADAMBAAIAAwAAABD4H//EABcRAQADAAAAAAAAAAAAAAAAAAEQEUH/2gAIAQMBAT8Qs0j/xAAWEQADAAAAAAAAAAAAAAAAAAAQIVH/2gAIAQIBAT8QdH//xAAdEAEAAgICAwAAAAAAAAAAAAABADERIUGBcZHw/9oACAEBAAE/EEGTUqE7IXiHPwlnLpeseplMF3LFZV4n/9k=","width":700,"height":394,"src":"/static/95d3d69e0e135990a2a634299cd43ae6/13e10/fast-city.jpg","srcSet":"/static/95d3d69e0e135990a2a634299cd43ae6/13e10/fast-city.jpg 1x"}}}}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"dir":"/microsoft-codepush-in-reactnative-tutorial/microsoft-codepush-in-reactnative-tutorial/","slug":"/blog/microsoft-codepush-integration-in-react-native-0.60","previous":{"fields":{"slug":"/blog/why-i-dropped-expo-and-embraced-react-native","dir":"/why-i-dropped-expo/why-i-dropped-expo/"},"frontmatter":{"title":"Why I Dropped Expo and embraced React Native","draft":null}},"next":null}}}