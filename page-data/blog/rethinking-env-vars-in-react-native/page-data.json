{"componentChunkName":"component---src-templates-blog-post-js","path":"/blog/rethinking-env-vars-in-react-native","webpackCompilationHash":"1d0885381d7fe9d600bc","result":{"data":{"site":{"siteMetadata":{"repoUrl":"https://github.com/giacomocerquone/giacomocerquone.com/tree/master/content/blog","siteUrl":"https://giacomocerquone.com"}},"markdownRemark":{"id":"e4bef703-e1ca-5d0e-a6c8-8e44f56b5e28","fields":{"readingTime":{"text":"7 min read"}},"excerpt":"We can say it: some parts of React Native are still missing and sometimes this may keep us on alert when developing an app made for the public.\nOne of the main…","html":"<p>We can say it: some parts of React Native are still missing and sometimes this may keep us on alert when developing an app made for the public.\nOne of the main pieces I think it’s missing, is the use of <strong>environment variables</strong>.</p>\n<p>For sure there are many packages that tries to help, yet I didn’t find one that was correctly working with my requirements.</p>\n<h2>Requirements</h2>\n<p>Let’s go for steps:</p>\n<ul>\n<li>I need many builds of my app and each of them must be configured accordingly.</li>\n<li>The same way of applying the configuration is needed while developing.</li>\n<li>It’s obvious that since the need of a build time configuration, the configuration must come from outside the javascript code.</li>\n<li>The configuration can also be guided by a single value.\nFor example I could inject a ‘stage’ string, and let the javascript code picks up a particular configuration object with the correct values.</li>\n</ul>\n<p><em>NOTE: As you may have read from this other post, I’m recently excluding Expo from my complex apps I’m working on.\nOn Expo we have what it’s called “ota channels”. When we request a particular build, you are asked for a string that represents the channel of the app will listen to when retrieving the OTA updates. With that I could accomplished what I’m asking.</em></p>\n<h2>My solution</h2>\n<h2>Alternatives</h2>\n<p>What are the available packages that didn’t work out for me?</p>\n<p>The problems with a common dotenv package in react-native are mainly two:</p>\n<ol>\n<li>They set env vars on the machine you’re running the code and very often, through the “boxed” frameworks I mentioned, it’s hard to access them.</li>\n<li>Once you find a way, it seems that’s almost impossible to set them at build time in a clean way. Sometimes you can decide between a dev and prod env, but very often these are meaningless and depend on the <code class=\"language-text\">__DEV__</code> you’re developing on and still you can’t set them the way you want when you want (look at <a href=\"https://github.com/zetachang/react-native-dotenv\">react-native-dotenv</a>)</li>\n</ol>\n<p>If they don’t have these problems, they’re hard to configure and built as a dependency and not as a devDependency.<br/>\nMeaning that stuff like <a href=\"https://github.com/luggit/react-native-config\">react-native-config</a> are native packages that must be linked and their code runs at runtime too.</p>\n<h3> Alternatives</h3>\n<h3>React-native-dotenv</h3>\n<p>This package goes very close to accomplish what I want for my build workflow but sadly they reached a dead end for various reasons:</p>\n<ul>\n<li>No possibility to choose a certain env file.\n<a href=\"https://github.com/zetachang/react-native-dotenv/pull/34\">Someone tried to implement</a> the possibility to select a specific env file through an env var (a sort of parent env var to orchestrate everything) but hit a wall when working with gradle and xcode</li>\n<li>The package is not maintained anymore and there is some low level problem to the whole architecture that forces you to edit the files that import the env vars when you change them in order to let them retrieve the new values. (I assume because of babel)</li>\n</ul>\n<hr>\n<h1>react-native-jsenv</h1>\n<p>A cli tool to inject values and env vars into code at build time or at runtime with zero dependency.</p>\n<h2>Naming</h2>\n<p>I decided to call this package with a prefixed “react-native” because as far as my experience goes it’s where it’s needed.\nPlus, like you’ll see, if it wasn’t for the possibility to inject env vars, it was merely a script to copy and paste one file, but still is a structured solution that almost no one uses and that I think must be discussed and used.</p>\n<h2>Usage</h2>\n<p><code class=\"language-text\">jsenv --input ./envsFiles/env.example.js --output ./src/constants/constants.js API_URL https://cat.it API_V=$API_V</code></p>\n<p>This will:</p>\n<ul>\n<li>take env.example.js and copy its content to constants.js</li>\n<li>set the API_URL variable of constants.js to <a href=\"https://cat.it\">https://cat.it</a></li>\n<li>set API_V variable of constants.js to the current env var value</li>\n</ul>\n<p>You can also set nested properties with the limitation of <strong>not being able to use dots</strong> in your properties names’.</p>\n<p>Ultimately you can get everything from the env vars in this way <strong>without being limited from the dot notation</strong>:</p>\n<p><code class=\"language-text\">jsenv --inputFromEnv --output ./src/constants.js</code></p>\n<h3>So I get OTA channels for free? You bet</h3>\n<p>Another problem we solve in a such easy way is the creation and definition of <a href=\"https://docs.expo.io/versions/latest/distribution/release-channels/\">release channels</a> (from expo terminology) with your favourite OTA updates system.<br />\nWith <a href=\"https://github.com/microsoft/react-native-code-push\">Microsoft CodePush</a>, for example, you can import the CODE PUSH key from the env.js file edited with this package at build time and direct the updates wherever you want.</p>\n<h2>Motivation</h2>\n<p>This package aims to solve a common front-end issue in the React Native ecosystem in a different way.<br /><br/>\nIt comes from problems and difficulties I experienced while building and working on pretty complex React Native apps.<br />\nIn fact this package ease down the complexities of defining env vars (or configuration variables I should say) in these “boxed” platforms/frameworks (like create-react-app, angular/cli, react-native etc. with complex webpack conf and thousands of plugin).<br/><br/>\nSo why use env vars when we already have the possibility to export something directly through the same language we’re writing the code? Of course is a provocative question, but not stupid. Many tools do this (metro.config, .babelrc etc.) but we’re not used to do it in our application’s code.<br/>\nThe <a href=\"https://12factor.net/config\">12 factor app</a> bless this in a certain sense:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Another approach to config is the use of config files which are not checked into revision control, such as config/database.yml in Rails.</code></pre></div>\n<p>Of course then it tries to explain basically that it’s prone to human errors (like everything I’d say) and then there are these assumptions:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Env vars are easy to change between deploys without changing any code.\nUnlike config files, there is little chance of them being checked into the code repo accidentally.\nThey are a language and OS-agnostic standard.</code></pre></div>\n<ul>\n<li>The first sentence is true, but only if the code runs in a machine we control.</li>\n<li>The second is pretty much false. We’re used to have dotenv files, so there is the same risk of committing that instead of a config file, plus in frontend apps, like React Native too, env vars <strong>are not</strong> hidden to the end user and for this reason it’s strongly advised to not store any sensitive information. So, again, it’s just configuration.</li>\n<li>The third sentence implies that should be easy to read them. It should indeed, but in the current situation it’s absolutely the opposite, it’s hard as fuck.</li>\n</ul>\n<p>In fact environment variables were started to be used in the developing world when you needed to configure an environment, indeeed, where your code would have run.</p>\n<p>As a front-end developer, I know that what we’re trying to accomplish isn’t the configuration of an environment, but the configuration of a specific build in a specific way and in such cases what we miss is a value, even a single string, that we can inject into a build from where you can deduct every other internal config value.<br/>\nAll those tools I quoted, except expo, doesn’t allow this as far as I know.\nCreate-React-App for example let you directly access the env vars in the system <strong>OR</strong> use a pre-defined file. It is something but I’d prefer a mix of the two, use an env var (or a CLI argv) that specify the file where to get the configuration from.</p>\n<p>But in React-native instead we have an even harder deficiency of not having any possibility to set an env var in a usual manner into the terminal and get</p>","frontmatter":{"imgAuthor":null,"imageAlt":null,"image":null,"slug":"blog/rethinking-env-vars-in-react-native","title":"Re-thinking env vars in React Native","date":"December 02, 2019","description":"If there is one thing I hate about react native it's the inexistent way of using environment variables"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"dir":"/rethinking-env-vars-in-react-native/rethinking-env-vars-in-react-native/","slug":"/blog/rethinking-env-vars-in-react-native","previous":{"fields":{"slug":"/blog/microsoft-codepush-integration-in-react-native-0.60","dir":"/microsoft-codepush-in-reactnative-tutorial/microsoft-codepush-in-reactnative-tutorial/"},"frontmatter":{"title":"Microsoft CodePush Integration in React Native 0.60+","draft":null}},"next":null}}}