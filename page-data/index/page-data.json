{"componentChunkName":"component---src-pages-index-js","path":"/","webpackCompilationHash":"5e315acc06bf2fa38dcd","result":{"data":{"site":{"siteMetadata":{"title":"Giacomo Cerquone","description":"Giacomo Cerquone, developer"}},"allMarkdownRemark":{"edges":[{"node":{"fileAbsolutePath":"/home/runner/work/giacomocerquone.com/giacomocerquone.com/content/home/bio.md","html":"<p>I love computer science and making beatiful programs.\nI have a computer science bachelor degree and 4 years of work experience as a remote freelancer mainly as a <strong>React Native/React</strong> developer.\nCinephile, astronomy lover, coffe and tea enthusiast and passionate about new technologies.\n<br>\n<strong>Writer</strong> and <strong>Admin</strong> @<a href=\"https://italiancoders.it/author/giacomo-cerquone/\">italiancoders.it</a> and @<a href=\"https://giacomocerquone.com/blog\">giacomocerquone.com</a></p>","frontmatter":{"title":null,"section":"bio","slug":null,"description":null}}},{"node":{"fileAbsolutePath":"/home/runner/work/giacomocerquone.com/giacomocerquone.com/content/home/pubs.md","html":"<p>A list of my publications on free online resources.</p>\n<p><a href=\"https://it.wikipedia.org/wiki/Utente:Giacomocerquone\">Wikipedia</a>: <a href=\"https://it.wikipedia.org/wiki/ECMAScript\">ECMAScript</a><br />\n<a href=\"https://developer.mozilla.org/it/profiles/giacomocerquone\">Mozilla.org</a>: <a href=\"https://developer.mozilla.org/it/docs/Web/JavaScript/Reference/Global_Objects/Function/apply\">Apply</a> <br/>\n<a href=\"https://italiancoders.it/author/giacomo-cerquone/\">ItalianCoders.it</a>: <a href=\"https://italiancoders.it/routing-delle-applicazioni-angular/\">Angular Routing</a>, <a href=\"https://italiancoders.it/creare-un-bot-per-messenger-in-nodejs/\">Facebook bot</a></p>","frontmatter":{"title":"Minor publications","section":"pubs","slug":null,"description":null}}},{"node":{"fileAbsolutePath":"/home/runner/work/giacomocerquone.com/giacomocerquone.com/content/blog/rethinking-env-vars-in-react-native/rethinking-env-vars-in-react-native.md","html":"<p>We can say it: some parts of React Native are still <strong>missing</strong> and sometimes this may keep us on alert when developing an app made for the public.<br/>\nOne of the main pieces I think it’s missing, is the use of <strong>environment variables</strong>.\n<br /><br />\nThis post comes from problems and difficulties I experienced while building and working on <strong>pretty complex</strong> React Native apps.<br/>\nFor sure many packages tries to help, yet I didn’t find one that was <strong>satisfying my requirements</strong>.<br/>\nSo if you’re searching for a straightforward solution, leave hope. Instead, if you know about this problem and didn’t find a solution that fits your need, keep reading :)</p>\n<h2>Requirements</h2>\n<p>Let’s go for steps:</p>\n<ul>\n<li>I need <strong>many builds</strong> of my app and each of them must be configured in a specific way.</li>\n<li>The same way of applying the configuration is needed <strong>while developing</strong> (so to have a “dev” configuration).</li>\n<li>It’s obvious that needing a build time configuration (a configuration that gets applied in a specific build), the configuration <strong>must come from outside</strong> the javascript code. And this is because we always build using native tools (gradle/xcodebuild).</li>\n<li>The configuration can also be guided by a <strong>single value</strong>.\nFor example, I could inject a ‘stage’ string, and let the javascript code picks up a particular <strong>configuration object</strong> with the correct values.</li>\n</ul>\n<p>In fact, what we want <strong>isn’t</strong> the configuration of an environment, but the configuration of a specific build in a specific way. Let’s understand why in the next paragraph.<br/><br/></p>\n<p><em>NOTE: As you may have read from this other post, I’m recently excluding Expo from the complex apps I’m working on.\nOn Expo, we have what it’s called ”<strong>OTA channels</strong>”. When we request a particular build, you are asked for a string that represents the channel of the app. It will listen to this channel and will retrieve the OTA updates. With that I could accomplish what I’m asking.</em></p>\n<h2>Why not a standard solution?</h2>\n<p>First of all, why do we use env vars at all?<br/>\nTo <strong>store secrets</strong> and to <strong>configure behaviours</strong> of an application.<br/>\nBut everything in a front-end app is <strong>free to be seen</strong> by anyone, so in React Native, for example, we might use them only to configure behaviors in a standard way.<br/>\nThen we must distinguish between:</p>\n<ol>\n<li>Using env vars in a <strong>boxed solution</strong> to create apps (one like create-react-app, react native, angular-cli, etc.)</li>\n<li>Using them in a custom solution (one that <strong>reimplements a webpack config</strong> basically).</li>\n</ol>\n<p>In the first kind, you’ll always be restricted somehow from the fact that those tools were born exactly to avoid the configuration pain.<br/>\nIn the second one, you’re free to go but it’s very hard to reimplement it and you will need to fix so many weird stuff during the journey that <strong>it may not worth the risk</strong>.</p>\n<p>So to find a solution in React Native, we can <strong>spy on solutions</strong> implemented by other tools.<br/>\n<strong>Create react app</strong>, for example, gives you this: <a href=\"https://create-react-app.dev/docs/adding-custom-environment-variables/\">https://create-react-app.dev/docs/adding-custom-environment-variables/</a> and it’s done through a custom webpack configuration done by the facebook team <a href=\"https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/config/webpack.config.js\">here</a> that uses <a href=\"https://github.com/facebook/create-react-app/blob/master/packages/react-scripts/config/env.js\">this code</a> to collect all the env vars defined with a <code class=\"language-text\">REACT_</code> prefix for each of them.</p>\n<p>Nice, but since in React Native we’re left alone, we should reimplement a custom webpack conf.<br/>\nLuckily there is already a <a href=\"https://github.com/mrsteele/dotenv-webpack#readme\">webpack plugin</a> to inject env vars, <strong>but</strong>, as we anticipated earlier, a custom configuration is <strong>really hard to achieve</strong>.\n<a href=\"https://github.com/reactnativecn/react-native-webpack\">This is the only attempt</a> at doing it that I could find online but it’s <strong>not updated</strong> and it’s so <strong>awkward</strong> that I’d prefer to not embark myself into a thing like this. (plus I’m almost sure that <strong>it doesn’t work as it is</strong>).</p>\n<p>Let’s find a different way to solve this issue then.</p>\n<h2>The idea</h2>\n<p>This is the idea: why use env vars when we already can export something directly through the same language we’re writing the code?<br/>\nOf course, this doesn’t come out of nowhere. Many tools do this already (metro.config, .babelrc, etc.) but we’re not used to do it in our application’s code.<br/>\nExamining the <a href=\"https://12factor.net/config\">twelve-factor app</a> manifesto we can get an intuition of why is that and what are the <strong>consequences</strong> of doing this:</p>\n<blockquote>\n<p>Another approach to config is the use of config files that are not checked into revision control, such as config/database.yml in Rails.</p>\n</blockquote>\n<p>Then it basically says that this is prone to human errors (like everything I’d say) and then there are these assumptions:</p>\n<blockquote>\n<p>Env vars are easy to change between deploys without changing any code.<br/>\nUnlike config files, there is little chance of them being checked into the code repo accidentally.<br/>\nThey are a language and OS-agnostic standard.</p>\n</blockquote>\n<p>In React Native:</p>\n<ul>\n<li>The first sentence is <strong>true</strong> but <strong>only</strong> if the code runs in a machine we control.</li>\n<li>The second is pretty much <strong>false</strong>. We’re used to have <strong>dotenv files</strong>, so there is the <strong>same risk</strong> of committing that instead of a config file.<br/>Plus in front-end apps, as we said, env vars are just configuration values.</li>\n<li>The third sentence implies that <strong>should be easy</strong> to read them from the code. It should be indeed, but in the current situation it’s <strong>absolutely the opposite</strong>.</li>\n</ul>\n<p>Why do we have such <strong>inconsistencies</strong> with this manifesto? Simple, because environment variables were started to be used in the developing world when you needed to configure an environment, indeed, where your code would have run, but not all kinds of development allow this.</p>\n<h1>The solution</h1>\n<p>I won’t go into details with all the implementations I tried and discarded, this post would become huge with all the considerations, the pros and cons. Consider only that, luckily for you, I’m using the following solution in many production apps and it’s going ok.\nIt’s very basic:</p>\n<ul>\n<li>Define an active.env.js file at the root of the project like this:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token string\">\"dev\"</span></code></pre></div>\n<ul>\n<li>Define configuration values in an env.js file like this:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Platform <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"react-native\"</span>\n\n<span class=\"token keyword\">import</span> active <span class=\"token keyword\">from</span> <span class=\"token string\">\"./active.env\"</span>\n\n<span class=\"token keyword\">const</span> envs <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  stage<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">DEV_API</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://staging.api.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">SOUNDS</span><span class=\"token punctuation\">:</span> Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"android\"</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  prod<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">DEV_API</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://prod.api.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">SOUNDS</span><span class=\"token punctuation\">:</span> Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"android\"</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  dev<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token constant\">DEV_API</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://dev.api.com\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token constant\">SOUNDS</span><span class=\"token punctuation\">:</span> Platform<span class=\"token punctuation\">.</span><span class=\"token constant\">OS</span> <span class=\"token operator\">===</span> <span class=\"token string\">\"android\"</span> <span class=\"token operator\">||</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> envs<span class=\"token punctuation\">[</span>active<span class=\"token punctuation\">]</span></code></pre></div>\n<ul>\n<li>You’ll use a shell script (or an npm package) within an npm script called, for example, “set-stage” which will write inside the active.env.js file the right string (env) to apply to the project. Something like this:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;set-stage&quot;: &quot;shx echo \\&quot;export default &#39;stage&#39;;\\&quot;&gt; active.env.js&quot;,</code></pre></div>\n<ul>\n<li>From wherever you want, import a configuration value like this:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> <span class=\"token constant\">DEV_API</span> <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">\"env.js\"</span></code></pre></div>\n<p>Now within each build process, you just have to automatize the changing of the content of the active.env.js file and you and leave it as “dev” the rest of the time.<br/>\nThis can be done through command concatenation (&#x26;&#x26; inside the npm scripts).</p>\n<h2>OTA channels</h2>\n<p>Another problem we solve in such easy way is the creation and definition of <a href=\"https://docs.expo.io/versions/latest/distribution/release-channels/\">release channels</a> (from expo terminology) with your favorite OTA updates system.<br />\nWith <a href=\"https://github.com/microsoft/react-native-code-push\">Microsoft CodePush</a>, which <a href=\"https://giacomocerquone.com/blog/microsoft-codepush-integration-in-react-native-0.60\">I talked about here</a> for example, you can import the CODE PUSH key from the right env javascript file at build time and correctly direct the updates.</p>\n<h2>Alternatives</h2>\n<h3>react-native-dotenv</h3>\n<p>This package goes <strong>very close</strong> to accomplish what I want for my build workflow but sadly they <strong>reached a dead-end</strong> for various reasons:</p>\n<ul>\n<li>No possibility to choose a certain env file.\n<a href=\"https://github.com/zetachang/react-native-dotenv/pull/34\">Someone tried to implement it</a> through an env var (a sort of parent env var to orchestrate everything) but hit a wall when working with gradle and xcode</li>\n<li>The package is not maintained anymore and there is some low-level problem to the whole architecture that forces you to edit the files that import the env vars when you change them to let them retrieve the new values. (I assume because of babel)</li>\n</ul>\n<h3>react-native-config</h3>\n<p>This one is the best you can get without coming up with your own implementation.<br />\nThe problem is that to achieve all those functionalities, it’s built as a dependency and not as a dev dependency (it must be linked and so <strong>the code runs at runtime</strong> too) and you have to tinker a bit on how to configure it properly both on xCode and Android Studio.</p>","frontmatter":{"title":"Re-thinking env vars in React Native","section":null,"slug":"blog/rethinking-env-vars-in-react-native","description":"If there is one thing I hate about react native it's the inexistent way of using environment variables"}}},{"node":{"fileAbsolutePath":"/home/runner/work/giacomocerquone.com/giacomocerquone.com/content/blog/microsoft-codepush-in-reactnative-tutorial/microsoft-codepush-in-reactnative-tutorial.md","html":"<p>The world has been spinning pretty fast lately, hasn’t it?\nIn the development process what we’re used to call ”<strong>continuous delivery</strong>” is what allowed us, as end-users, to perceive changes in a blazingly fast way and it’s what allows us, as developers, to <strong>push fixes</strong> and new features faster to the end-user.</p>\n<p>You’ll find <strong>so many</strong> articles about it and maybe you still are figuring out what it really is but remember, these apparently abstract and hard to follow concepts that pops up here and there nowadays always boil down somehow to something practical: a tool, a service or an architecture that let you do something.</p>\n<p>But how can we effectively do this in the world of mobile development? Through <strong>over-the-air</strong> updates.\nIt’s the ability of an app to receive bugfixes and features that can be <strong>applied at runtime</strong> and refresh the user experience. This means no store approval, no build time and lots of other simplifications.</p>\n<p><em>NOTE: <strong>I’ll keep this guide updated</strong> at the best of my possibilities for every react-native-code-push update. If you feel something is missing, ping me on <a href=\"https://twitter.com/giacomocerquone\">Twitter</a> or send me an email</em></p>\n<h2>General inner working</h2>\n<p>I won’t talk about other platforms, but OTA updates aren’t possible on every framework due to their different inner workings.\nIn React Native we are “required” to build a <strong>JavaScript bundle</strong> to produce a production app. That js bundle, called index.android.bundle in Android and main.jsbundle in iOS, is bundled within the aab/apk/ipa and then the Java/Obj-C code of our React Native app will use it.\nSo how are OTA delivered? Simple, replacing that bundle, when certain conditions are met, through a native linked library that restarts the execution of that bundle at runtime.</p>\n<p>Now <strong>understanding how something works</strong> is the only way you can <strong>improve yourself</strong> and become as independent as possible. I might also have attempted to develop a personal implementation of this mechanism, but it’d be silly since we have <strong>Microsoft CodePush</strong>: a tool, inside the app center, made exactly to deliver OTA updates.</p>\n<h2>Configuration</h2>\n<p>Online resources are a bit scarce on how to:</p>\n<ul>\n<li>Use the <a href=\"http://appcenter.ms/apps\">appcenter.ms</a> website dashboard</li>\n<li>Properly configure this library</li>\n<li>Use the appcenter cli</li>\n</ul>\n<p>There is a <a href=\"https://docs.microsoft.com/en-us/appcenter/\">huge unhandy Microsoft documentation</a> about it, but at the same time, it’s possible to find many commands out in the wild of the <strong>old version</strong> of the cli that don’t work anymore.</p>\n<h2>Configure the app in the App Center dashboard</h2>\n<p>There shouldn’t be the need of explaining how the app should be set up on the App Center dashboard but, it turns out there is a very peculiar thing I discovered and so I decided to walk you step by step in this.</p>\n<ol>\n<li>Signup</li>\n<li>Go to your <a href=\"https://appcenter.ms/apps\">apps’ dashboard</a>.</li>\n<li>You’ll need to add two apps. Basically, you can’t configure a single app (and therefore use a single key) to release updates to both your Android and iOS apps. <strong>You must configure two apps targeting two different OS</strong>. This is confusing also because an old version of the cli allowed to specify multiple OS of a single app when releasing the updates.*\nConfigure them like this, once selecting iOS and once Android in the OS field (leave the Release Type empty, this has nothing to do with CodePush):\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/233bfa1ddf29bda708ad4045d2c97131/a987b/step.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.42708333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAAApUlEQVQoz72Nyw6CMBBF+/8/5s4PcGHiIyVSOoUKnaFQSmGMiAsfMfGs7jzOjMgOZ9DaWkuI3Tv6iRCHUDm/PdVCZpmUUinlmrp/ifceEavKlqWpqdtdGlEklAJjLPkQQnxgmOHAo3SC/3NTpJ8qzwuA4xUdUlzDTtpLDpd8jrOY3RwAHE20a+4dDk8Li9zS1ywy/VNuf5EbhzdZa/25hki9p83ejDNxQx8JBFPkAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Add app in App Center\"\n        title=\"Add app in App Center\"\n        src=\"/static/233bfa1ddf29bda708ad4045d2c97131/b9e4f/step.png\"\n        srcset=\"/static/233bfa1ddf29bda708ad4045d2c97131/cf440/step.png 148w,\n/static/233bfa1ddf29bda708ad4045d2c97131/d2d38/step.png 295w,\n/static/233bfa1ddf29bda708ad4045d2c97131/b9e4f/step.png 590w,\n/static/233bfa1ddf29bda708ad4045d2c97131/f9b6a/step.png 885w,\n/static/233bfa1ddf29bda708ad4045d2c97131/2d849/step.png 1180w,\n/static/233bfa1ddf29bda708ad4045d2c97131/a987b/step.png 1920w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></li>\n<li>Open your app and on the left panel select “Distribute -> CodePush -> Create standard deployments”</li>\n<li>You’ll have a dropdown selection and a wrench icon in the upper-right corner!\nThe <strong>dropdown</strong> indicates the current deployment name you’re viewing, the <strong>wrench icon</strong> lets you open a side-panel which gives you <strong>the keys</strong> your app will use to retrieve the bundles (store this somewhere momentarily in order to use them in the next steps).</li>\n</ol>\n<p>That’s it.</p>\n<p><em>*NOTE: in the docs this is taken for granted and nowhere seems to be mentioned, the only warning you can find is this and it doesn’t tell us much</em></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1e77f59b19b553cebee89590b24fe158/8b843/appcenter-warning.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.22347066167291%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAEABQDASIAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAAAAEDBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB2INLBH//xAAWEAEBAQAAAAAAAAAAAAAAAAAAAUH/2gAIAQEAAQUC1H//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAZEAACAwEAAAAAAAAAAAAAAAAAAREhMVH/2gAIAQEAAT8hcyt6X1mT/9oADAMBAAIAAwAAABAEH//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABURAQEAAAAAAAAAAAAAAAAAAAAB/9oACAECAQE/EFf/xAAaEAACAwEBAAAAAAAAAAAAAAAAASExQRHh/9oACAEBAAE/EHp0tO+od3bc6f/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"App Center Warning\"\n        title=\"App Center Warning\"\n        src=\"/static/1e77f59b19b553cebee89590b24fe158/c739e/appcenter-warning.jpg\"\n        srcset=\"/static/1e77f59b19b553cebee89590b24fe158/8ee9c/appcenter-warning.jpg 148w,\n/static/1e77f59b19b553cebee89590b24fe158/ebbe7/appcenter-warning.jpg 295w,\n/static/1e77f59b19b553cebee89590b24fe158/c739e/appcenter-warning.jpg 590w,\n/static/1e77f59b19b553cebee89590b24fe158/8b843/appcenter-warning.jpg 801w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Linking and JS implementation</h2>\n<p>The entire library is going under heavy maintenance (almost abandoned I’d say, like lots of React native Microsoft contributions) and for this reason, something may be a bit outdated and something else might be missing: <strong>no hooks support</strong>, <strong>no autolinking support</strong>.\nIt exposes a HOC or some “low level” functions we can use to configure how the updates should be retrieved by the app (<a href=\"https://github.com/microsoft/react-native-code-push/blob/master/docs/api-js.md\">here the doc</a>).\nSince this library doesn’t support auto-linking, when installed you must launch <strong>react-native link react-native-code-push</strong> and it will ask you for <strong>only one</strong> of the key retrieved at the previous step.\nMy advice here is:</p>\n<ol>\n<li><strong>Write it in the terminal</strong> while linking if you know you’ll just use one deployment key for your app (the key relative to the <em>Production</em> deployment name for example).</li>\n<li>Leave it empty if you plan to use various deployments (<em>Production</em>, <em>Staging</em> ecc.) to effectively <strong>handle the keys from the js side</strong>.</li>\n</ol>\n<p>The first one has a <strong>simpler js configuration</strong>, you just need to wrap your app entry point with the CodePush HOC. Something like:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">codePush</span><span class=\"token punctuation\">(</span>MyApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The second one instead requires us to specify the Code Push-Key inside the codePush HOC:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">MyApp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> <span class=\"token function\">codePush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  deploymentKey<span class=\"token punctuation\">:</span> <span class=\"token string\">'YOURKEY'</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">:</span> CodePushOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>MyApp<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>You can check the <strong>CodePushOptions type</strong> <a href=\"https://github.com/microsoft/react-native-code-push/blob/master/docs/api-js.md#codepushoptions\">here</a>. It allows us to set all kinds of behaviors when an update is available to be downloaded. Alerts, percentage progress, completely silent, apply at restart, etc. etc.</p>\n<p><em>NOTE: Pay attention to when you’d like to hide your splash screen or stop your loader since you might also want to completely hide the whole process to the user. You can do it through the second parameter of the CodePush key which is an update callback to retrieve the process status</em></p>\n<p>I want also to be very clear about the second way I proposed:</p>\n<ul>\n<li><strong>It isn’t the only way</strong> to use multiple keys (the easier for me)</li>\n<li>It is <strong>very dangerous</strong> to use it without a <em>safe and good env vars handling in react-native</em> (<strong>this will be my next post’s topic</strong>) which is almost impossible considering the tools and libs we have at the moment.</li>\n</ul>\n<h2>Important CLI commands</h2>\n<p>Let’s see a handy <strong>collection</strong> of the main useful commands you can refer to <br/></p>\n<p><em>NOTE: Microsoft calls it deployment name (or simply deployment), it is also often referred to as lanes, product flavors, build schemes or also specific deploy and they indicate some sort of specific configuration of your app: stage, dev, production, production-IT ecc.</em></p>\n<h4>DEPLOY (to a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush release-react -a &lt;owner&gt;/&lt;appName&gt; -d &lt;deploymentName&gt; -t &lt;version&gt;</code></pre></div>\n<h4>LIST APPS FOR CURRENT USER</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter apps list</code></pre></div>\n<h4>ADD A DEPLOYMENT NAME (to an app)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush deployment add -a {owner}/{appName} &lt;deploymentName&gt;</code></pre></div>\n<h4>LIST DEPLOYMENT NAMES AND KEYS (of an app)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush deployment list -a {owner}/{appName} --displayKeys</code></pre></div>\n<h4>DELETE ALL EXISTING RELEASES (of a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush deployment clear -a &lt;ownerName&gt;/&lt;appName&gt; &lt;deploymentName&gt;</code></pre></div>\n<h4>UNDO LAST RELEASE (of a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush rollback -a &lt;owner-name&gt;/&lt;app-name&gt; &lt;deploymentName&gt;</code></pre></div>\n<h4>DISABLE SPECIFIC RELEASE (of a deployment name)</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">appcenter codepush patch -a &lt;owner-name&gt;/&lt;app-name&gt; &lt;deploymentName&gt; &lt;existingReleaseLabel&gt; --disabled</code></pre></div>\n<p><code class=\"language-text\">patch</code> is a very powerful utility that lets you modify a release. <a href=\"https://docs.microsoft.com/en-us/appcenter/distribution/codepush/cli#patching-update-metadata\">Make sure to check out the docs</a> to discover what you can do with it!</p>\n<p><em>NOTE: the difference between disabling and rolling back is that the first one just disable a release so the app will get the previous one while the rollback create a new release equal to the second-last release to nullify the latest</em></p>\n<p>If you need any kind of support, <strong>reach out to me on Twitter</strong>, I’d be glad to help.</p>","frontmatter":{"title":"Microsoft CodePush Integration in React Native 0.60+","section":null,"slug":"blog/microsoft-codepush-integration-in-react-native-0.60","description":"Microsoft CodePush is a powerful tool but can be very exhausting to configure. Let's cycle over the necessary details"}}},{"node":{"fileAbsolutePath":"/home/runner/work/giacomocerquone.com/giacomocerquone.com/content/blog/why-i-dropped-expo/why-i-dropped-expo.md","html":"<p>As some of you may know, I’m currently working as a freelancer in React Native and constantly shipping and curating some apps. I may not have created 100+ apps like this guy on <a href=\"https://dev.to/kylessg/ive-released-over-100-apps-in-react-native-since-2015-ask-me-anything-1m9g\">dev.to</a>, but I made quite a few of them and all were data centric with lots of screens and user inputs handling (we don’t like simple challenges right?).\nFor one of the last I also needed a personalized component that required some tweaking around the two libs gesture-handler and reanimated.</p>\n<h2>Disclaimer</h2>\n<p>The whole article isn’t made to go against people who are passionate about what they do and believe in their projects like the Expo team.\nThe last thing I want to do is to discredit their work! They are awesome people and developers but, as every product, Expo gets its own reviews too and with this I’ll give mine based on my little experience.</p>\n<h3>Who is this post for</h3>\n<p>Having said that, things will surely change and opinions too. Plus we all might have different ideas and an important thing is that the advices you’ll find in this post won’t work for everyone, I believe they’ll work for a developer who:</p>\n<ul>\n<li>Has always used expo and is forced to abandon it because of some requirements at work</li>\n<li>Wants to discover the internals of the framework</li>\n<li>Like me has been scared by the first versions of the framework and he’s thinking to retry it</li>\n<li>Is tired of something in the expo ecosystem</li>\n</ul>\n<h2>From the beginning</h2>\n<p>I started developing in pure React Native 3 years ago, it was surely a more immature framework than now and the major pain point for me was the unknown native side. After lots of fight with it (upgrading a React Native version was a huge pain, setting up some native modules just ended up screwing the entire project, and many other things) I wanted to gave expo a try, it looked like heaven: no native dependencies, no native manifest or plist to edit, nothing weird had to be done to create a splash screen and most of all, one command to build an ios app… <strong>in pure React Native long ago I struggled so much more than I should have to build an iOS app</strong> (probably because of the missing resources in the first days).\nExpo has an awesome developer experience, so awesome that it became almost instantly poisonous to me.\nThey created a beautiful structure that locks you in, not on purpose of course, but based on the limitations that come from having such a painless experience. Simplification comes always at a cost, the world itself works in this way, and the cost suddenly became too high for me.\nEspecially because once you’re in you soon start to think that without what expo does for you, would not be possible to build what you’re building and that once made that choice, you cannot easily go back.</p>\n<p>These limitations are of all kind of genres, some are explicit (they write them in <a href=\"https://docs.expo.io/versions/latest/introduction/why-not-expo/\">its website</a>) and others, well, are implicit of course, since questions like: “will that thing ever work?” “who knows? Maybe in v34, but not in v36” or like: “this core piece of my app is broken because one of your module doesn’t work. What do I do now?” “eject of course” “well why I used expo in the first place?” don’t have a straightforward answer and the answer comes at high costs</p>\n<h2>We should not avoid what’s native</h2>\n<p>The first thing you’re trying to avoid when using expo is the very reason why React Native, or any other technology that follows the same structure, is better than any other previous cross-platform solution: the native side of your app.\nIt’s comprehensible, it’s a mistake I did too the one of trying to avoid at all costs touching the native projects with their respective IDEs and we’re not even talking about writing native code (that is a thing I’m not yet comfortable with), but just configuration. But turns out that it’s actually a strong point having at hand all the native side tools.\nIt’s obvious that being web devs we know nothing about native development nor about its tools, but native developers needed simplifications too in all the tedious tasks so they built the icon generator, the visual tool to build UI and many other stuff that help us a lot (often not as much as expo but still it’s almost equally simple).\nAnd when you need to touch some code or some configuration file, I want you to remind of this: seeing react-native/Obj-c/Java code for the first time is a bit like reading complex math for the first time too! Initially you don’t understand shit, but as you get comfortable with the notation, syntax and terminology you start solving problems.</p>\n<h2>The technical problems I’ve found</h2>\n<p>Not that I’m leaving expo because I have encountered technical problems with it, but here there are a few I encountered in my pretty long and intense journey.</p>\n<ul>\n<li>An inconsistency between the dev and the prod environment, meaning that sometimes the app in prod will crash without knowing why (and it’s such a painful experience since you don’t know how to debug, logcat for android for example is almost never helpful in that) and it has very often to do with the app.json file of your app that is missing the right configurations.</li>\n<li>Some APIs that just do not work. I’ve followed all the new “background” geolocation implementation introduced in SDK 32 and, in SDK 34, it still doesn’t work. They know it of course, but the expo team has such a large number of things to look for that I understand it’s not easy at all.</li>\n<li>It feels horribly wrong when loading fonts, for example, to call that ”<a href=\"https://docs.expo.io/versions/latest/guides/using-custom-fonts/#loading-the-font-in-your-app\">loadAsync</a>” (the fonts are normally imported in the native project in a bare React Native environment instead of being loaded at runtime).</li>\n<li>I could mention many many more problems that I encountered (or I’m still encountering) in certain version of the sdk and be clear that some of them (like the one that is still in almost 2020 <a href=\"https://github.com/expo/expo/issues/2172\">affecting the keyboard behaviour</a> in all of the screens of your app) aren’t related to certain native modules provided by expo, but they’re there just because you use expo.</li>\n<li>Apps weight <a href=\"https://expo.canny.io/feature-requests/p/reducing-app-size\">really too much</a>.</li>\n<li>Requesting permissions you’ll never use, IDFA and other bad stuff <a href=\"https://github.com/expo/expo/issues/1138\">almost no one talk about</a>.</li>\n</ul>\n<h2>Ejecting? No thanks. Better building from the ground up</h2>\n<p>This post was born from the needs to completely detach, but in the real meaning of the word, an app from expo for a client’s project.\nUsing the <code class=\"language-text\">expo eject</code> command is something I completely discourage. It’s something that even they are dismissing in favour of unimodules (more on later) and that will give you more headaches than directly porting back the entire app in a new bare react native project.</p>\n<h2> The things I love of Expo and tried to bring to the native side</h2>\n<p>There is a but to all this matter.\nIt’s true that I wouldn’t rely on it for a working project no more (mainly for the constant fear of failing the release date because of some unexpected problem I <strong>can’t</strong> quickly fix), but there are a couple of things I missed so much that I wanted to port somehow to the React Native side:</p>\n<ul>\n<li>OTA updates (<a href=\"https://github.com/microsoft/react-native-code-push\">CodePush</a> which is even a lot better and fine tuned to your needs)</li>\n<li>OTA channels configuration in the way I was used to create them in Expo at build time</li>\n<li>A simple way of building the app… couldn’t they think of a simple damn command? lol</li>\n</ul>\n<p>The last two will be the subject of a series of future posts :) Stay tuned</p>\n<h4>(Unimodules)</h4>\n<p>This is the “things will surely change” I was talking about in the beginning. Unimodules is an ambitious project of bringing the possibility to import even a single module between the many that are available in Expo in a pure React Native project.\nHow can they do this and what prevented it in the first place? Well, basically all the goodies we’re used to have in Expo relies on the fact that all the code we write will run in an already well configured and predictive react native app heavily configured, but not necessarily through the use of custom native modules, in order to expose some primitives that many native features use.\nSo they did what they were doing but through a common way in the React Native ecosystem: using native modules.\nBut since there was the need of a base that could let all the other modules work, they created the <a href=\"https://github.com/unimodules/react-native-unimodules\">Core Unimodules</a> which requires itself all kind of permissions for your app (an old story, right?) <a href=\"https://github.com/unimodules/react-native-unimodules#add-permission-usage-description-keys-to-infoplist\">just because it’s included</a>, even if you don’t require anything that needs those permissions to run (but I honestly believe it’s a matter of time they enable some sort of three shaking to avoid this).</p>","frontmatter":{"title":"Why I Dropped Expo and embraced React Native","section":null,"slug":"blog/why-i-dropped-expo-and-embraced-react-native","description":"What are the main problems with Expo at this time? And what can be the advantages of using a pure React Native workflow?"}}}]}},"pageContext":{"isCreatedByStatefulCreatePages":true}}}